import { Flags } from '@oclif/core';
import Command from '@shopify/cli-kit/node/base-command';
import { outputWarn } from '@shopify/cli-kit/node/output';
import { renderWarning } from '@shopify/cli-kit/node/ui';
import { commonFlags } from '../../lib/flags.js';

const deploymentLogger = (message, level = "info") => {
  if (level === "error" || level === "warn") {
    outputWarn(message);
  }
};
class Deploy extends Command {
  static flags = {
    "env-branch": Flags.string({
      char: "e",
      description: "Environment branch (tag) for environment to deploy to",
      required: false
    }),
    force: Flags.boolean({
      char: "f",
      description: "Forces a deployment to proceed if there are uncommited changes in its Git repository.",
      default: false,
      env: "SHOPIFY_HYDROGEN_FLAG_FORCE",
      required: false
    }),
    path: commonFlags.path,
    shop: commonFlags.shop,
    "public-deployment": Flags.boolean({
      env: "SHOPIFY_HYDROGEN_FLAG_PUBLIC_DEPLOYMENT",
      description: "Marks a preview deployment as publicly accessible.",
      required: false,
      default: false
    }),
    "no-json-output": Flags.boolean({
      description: "Prevents the command from creating a JSON file containing the deployment URL (in CI environments).",
      required: false,
      default: false
    }),
    token: Flags.string({
      char: "t",
      description: "Oxygen deployment token",
      env: "SHOPIFY_HYDROGEN_DEPLOYMENT_TOKEN",
      required: false
    }),
    "metadata-description": Flags.string({
      description: "Description of the changes in the deployment. Defaults to the commit message of the latest commit if there are no uncommited changes.",
      required: false,
      env: "SHOPIFY_HYDROGEN_FLAG_METADATA_DESCRIPTION"
    }),
    "metadata-url": Flags.string({
      description: "URL that links to the deployment. Will be saved and displayed in the Shopify admin",
      required: false,
      env: "SHOPIFY_HYDROGEN_FLAG_METADATA_URL"
    }),
    "metadata-user": Flags.string({
      description: "User that initiated the deployment. Will be saved and displayed in the Shopify admin",
      required: false,
      env: "SHOPIFY_HYDROGEN_FLAG_METADATA_USER"
    }),
    "metadata-version": Flags.string({
      description: "A version identifier for the deployment. Will be saved and displayed in the Shopify admin",
      required: false,
      env: "SHOPIFY_HYDROGEN_FLAG_METADATA_VERSION"
    })
  };
  static hidden = true;
  async run() {
    renderWarning({
      body: "Deploy command unavailable.",
      nextSteps: [
        "To use the deploy command, upgrade cli-hydrogen to v7.0.0+."
      ]
    });
  }
}

export { Deploy as default, deploymentLogger };
