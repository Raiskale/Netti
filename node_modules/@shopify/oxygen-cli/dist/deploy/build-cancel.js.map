{"version":3,"sources":["../../src/deploy/build-cancel.ts"],"names":[],"mappings":"AAAA,SAAQ,sBAAqB;AAC7B,SAAQ,kBAAiB;AACzB,SAAgB,kBAAiB;AAEjC,SAAQ,cAAc,cAAa;AAGnC;AAAA,EACE;AAAA,OAGK;AASP,eAAsB,YACpB,SAC8B;AAC9B,QAAM,EAAC,QAAQ,SAAS,QAAQ,OAAM,IAAI;AAE1C,QAAM,YAAY;AAAA,IAChB;AAAA,IACA;AAAA,EACF;AAEA,MAAI;AACF,UAAM,WAAiC,MAAM,eAAe;AAAA,MAC1D,OAAO;AAAA,MACP,KAAK;AAAA,MACL,KAAK,GAAG,OAAO,aAAa;AAAA,MAC5B,OAAO,OAAO,gBAAgB;AAAA,MAC9B,cAAc;AAAA,QACZ,CAAC,OAAO,qBAAqB,GAAG,OAAO,gBAAgB;AAAA,MACzD;AAAA,MACA;AAAA,IACF,CAAC;AAED,QAAI,SAAS,YAAY,WAAW,UAAU,GAAG;AAC/C,YAAM,IAAI;AAAA,QACR,2BAA2B,SAAS,YAAY,WAAW,CAAC,GAAG,OAAO;AAAA,MACxE;AAAA,IACF;AACA,eAAW,iBAAiB,OAAO,eAAe,MAAM;AAExD,WAAO,SAAS;AAAA,EAClB,SAAS,OAAO;AACd,iBAAa,KAAK;AAElB,UAAM;AAAA,EACR;AACF","sourcesContent":["import {graphqlRequest} from '@shopify/cli-kit/node/api/graphql';\nimport {AbortError} from '@shopify/cli-kit/node/error';\nimport {Logger, outputInfo} from '@shopify/cli-kit/node/output';\n\nimport {errorHandler, Header} from '../utils/utils.js';\n\nimport type {DeploymentConfig} from './types.js';\nimport {\n  BuildCancelQuery,\n  BuildCancelQueryData,\n  BuildCancelResponse,\n} from './graphql/build-cancel.js';\n\ninterface BuildCancelOptions {\n  config: DeploymentConfig;\n  buildId: string;\n  reason: string;\n  logger: Logger;\n}\n\nexport async function buildCancel(\n  options: BuildCancelOptions,\n): Promise<BuildCancelResponse> {\n  const {config, buildId, reason, logger} = options;\n\n  const variables = {\n    buildId,\n    reason,\n  };\n\n  try {\n    const response: BuildCancelQueryData = await graphqlRequest({\n      query: BuildCancelQuery,\n      api: 'Oxygen',\n      url: `${config.deploymentUrl}/api/v2/admin/graphql`,\n      token: config.deploymentToken.accessToken,\n      addedHeaders: {\n        [Header.OxygenNamespaceHandle]: config.deploymentToken.namespace,\n      },\n      variables,\n    });\n\n    if (response.buildCancel.userErrors.length >= 1) {\n      throw new AbortError(\n        `Failed to cancel build: ${response.buildCancel.userErrors[0]?.message}`,\n      );\n    }\n    outputInfo(`Build with id ${buildId} cancelled.`, logger);\n\n    return response.buildCancel;\n  } catch (error) {\n    errorHandler(error);\n\n    throw error;\n  }\n}\n"]}